<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tablero TV - Ahorcado</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { background: #0a0a12; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; overflow: hidden; }
        .game-layout { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .Wuachiturros { color: #00f2ff; text-shadow: 0 0 20px #00f2ff; }
        .Chapisa { color: #ff00ff; text-shadow: 0 0 20px #ff00ff; }
        #hangman-svg { width: 280px; height: 280px; margin: 10px; }
        .draw-part { fill: none; stroke: white; stroke-width: 4; opacity: 0.05; transition: opacity 0.5s; }
        .draw-part.visible { opacity: 1; stroke: #ff4444; filter: drop-shadow(0 0 8px #ff4444); }
        #palabraDisplay { font-size: 80px; margin: 20px; letter-spacing: 15px; font-family: monospace; min-height: 100px; }
        .vidas-box { font-size: 24px; padding: 10px 40px; border: 2px solid #333; border-radius: 50px; background: #1a1a2e; }
        h1 { font-size: 60px; margin: 10px 0; }
    </style>
</head>
<body onclick="document.querySelectorAll('audio').forEach(a => a.muted = false)">
    <div class="game-layout">
        <h1 id="status">ESPERANDO CAPITANES</h1>
        <h2 id="turnoDisplay">TURNO: <span id="equipoNombre">---</span></h2>

        <svg id="hangman-svg" viewBox="0 0 200 250">
            <path d="M20,230 L180,230 M50,230 L50,20 L120,20 L120,50" stroke="white" stroke-width="4" fill="none" />
            <circle id="p1" class="draw-part" cx="120" cy="70" r="20" />
            <path id="p2" class="draw-part" d="M120,90 L120,160" />
            <path id="p3" class="draw-part" d="M120,110 L90,140" />
            <path id="p4" class="draw-part" d="M120,110 L150,140" />
            <path id="p5" class="draw-part" d="M120,160 L90,200" />
            <path id="p6" class="draw-part" d="M120,160 L150,200" />
        </svg>

        <div id="palabraDisplay">_ _ _ _ _</div>
        <div class="vidas-box">ERRORES: <span id="errores" style="color: #ff4444;">0</span> / <span id="maxVidas">0</span></div>

        <audio id="snd-success" src="https://actions.google.com/sounds/v1/cartoon/clink_clanking_pots.ogg"></audio>
        <audio id="snd-fail" src="https://actions.google.com/sounds/v1/horror/creak_free_door_close.ogg"></audio>
        <audio id="snd-victory" src="https://actions.google.com/sounds/v1/human_voices/applause.ogg"></audio>
    </div>

    <script>
        const socket = io();
        let lastErr = 0, lastAc = 0;

        socket.on('updateState', (state) => {
            if (state.estado === "SETUP") {
                document.getElementById('status').innerText = "ESPERANDO PALABRA...";
                document.getElementById('palabraDisplay').innerText = "_ _ _ _ _";
                document.getElementById('equipoNombre').innerText = "CAPITÁN " + state.equipoQuePonePalabra;
                document.getElementById('equipoNombre').className = state.equipoQuePonePalabra;
                for(let i=1; i<=6; i++) document.getElementById('p' + i).classList.remove('visible');
                lastErr = 0; lastAc = 0;
                return;
            }

            const acActuales = state.letrasAdivinadas.filter(l => state.palabra.includes(l)).length;
            if (state.estado === "JUGANDO") {
                if (state.errores > lastErr) document.getElementById('snd-fail').play().catch(()=>{});
                else if (acActuales > lastAc) document.getElementById('snd-success').play().catch(()=>{});
            } else if (state.estado.startsWith("GANO")) {
                document.getElementById('snd-victory').play().catch(()=>{});
                lanzarCelebracion();
            }
            lastErr = state.errores; lastAc = acActuales;
            actualizarUI(state);
        });

        function actualizarUI(state) {
            const eq = document.getElementById('equipoNombre');
            eq.innerText = state.turno; eq.className = state.turno;
            
            if(state.estado === "JUGANDO") {
                document.getElementById('status').innerText = "¡ADIVINEN!";
                document.getElementById('palabraDisplay').innerText = state.palabra.split('').map(l => state.letrasAdivinadas.includes(l) ? l : "_").join(' ');
            } else if (state.estado.startsWith("GANO")) {
                document.getElementById('status').innerText = "¡VICTORIA!";
            } else if (state.estado.startsWith("PERDIO")) {
                document.getElementById('status').innerText = "¡FIN! ERA: " + state.palabra;
            }

            document.getElementById('errores').innerText = state.errores;
            document.getElementById('maxVidas').innerText = state.vidasTotales;

            for(let i=1; i<=6; i++) {
                const part = document.getElementById('p' + i);
                if (state.errores >= (state.vidasTotales / 6) * i) part.classList.add('visible');
            }
        }

        function lanzarCelebracion() {
            const end = Date.now() + 4000;
            const interval = setInterval(() => {
                if (Date.now() > end) return clearInterval(interval);
                confetti({ particleCount: 40, origin: { x: Math.random(), y: Math.random() - 0.2 }, colors: ['#00f2ff', '#ff00ff'] });
            }, 250);
        }
    </script>
</body>
</html>
